# models/mongo_schemas.py
from pymongo import MongoClient
from datetime import datetime
import os

client = MongoClient(os.getenv("MONGO_URI"))
db = client["chatbot"]
messages = db["messages"]

def save_message(convo_id, role, content):
    messages.insert_one({
        "conversation_id": convo_id,
        "role": role,
        "content": content,
        "timestamp": datetime.utcnow()
    })

def get_conversation_history(convo_id):
    return [
        {"role": m["role"], "content": m["content"]}
        for m in messages.find({"conversation_id": convo_id}).sort("timestamp", 1)
    ]
